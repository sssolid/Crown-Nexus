<template><div class="part-details"><template v-if="part"><v-row><v-col cols="12"><DetailCard title="Part Information" icon="mdi-wrench" :loading="loading" :error="error" ><v-row><v-col cols="12" md="6"><InfoList :items="partInfo" /></v-col><v-col cols="12" md="6" v-if="part.description"><v-card flat border><v-card-title>Description</v-card-title><v-card-text>{{ part.description }}</v-card-text></v-card></v-col></v-row></DetailCard></v-col></v-row><v-row v-if="part.categories && part.categories.length > 0"><v-col cols="12" md="6"><DetailCard title="Categories" icon="mdi-folder"><v-list density="compact"><v-list-item v-for="(categoryInfo, index) in part.categories" :key="index"><v-list-item-title>{{ categoryInfo.category.category_name }}</v-list-item-title><v-list-item-subtitle> Subcategory: {{ categoryInfo.subcategory.subcategory_name }} </v-list-item-subtitle></v-list-item></v-list></DetailCard></v-col><v-col cols="12" md="6" v-if="part.positions && part.positions.length > 0"><DetailCard title="Positions" icon="mdi-car-wrench"><v-chip-group class="ma-2"><v-chip v-for="position in part.positions" :key="position.id" color="primary" variant="outlined" class="ma-1" > {{ position.name }} </v-chip></v-chip-group></DetailCard></v-col></v-row><v-row><v-col cols="12" md="6" v-if="part.superseded_by && part.superseded_by.length > 0"><DetailCard title="Superseded By" icon="mdi-arrow-up-bold"><v-list density="compact"><v-list-item v-for="supersededBy in part.superseded_by" :key="supersededBy.id" :to="{ name: 'pcdb-part-details', params: { id: supersededBy.id } }" ><v-list-item-title>{{ supersededBy.name }}</v-list-item-title><v-list-item-subtitle>Part ID: {{ supersededBy.id }}</v-list-item-subtitle></v-list-item></v-list></DetailCard></v-col><v-col cols="12" md="6" v-if="part.supersedes && part.supersedes.length > 0"><DetailCard title="Supersedes" icon="mdi-arrow-down-bold"><v-list density="compact"><v-list-item v-for="supersedes in part.supersedes" :key="supersedes.id" :to="{ name: 'pcdb-part-details', params: { id: supersedes.id } }" ><v-list-item-title>{{ supersedes.name }}</v-list-item-title><v-list-item-subtitle>Part ID: {{ supersedes.id }}</v-list-item-subtitle></v-list-item></v-list></DetailCard></v-col></v-row><v-row v-if="partAttributes && partAttributes.attributes.length > 0"><v-col cols="12"><DetailCard title="Part Attributes" icon="mdi-format-list-bulleted"><v-table><thead><tr><th>Attribute</th><th>Type</th><th>Values/Constraints</th></tr></thead><tbody><tr v-for="attr in partAttributes.attributes" :key="attr.assignment_id"><td><strong>{{ attr.attribute.name }}</strong><div v-if="attr.attribute.description" class="text-caption"> {{ attr.attribute.description }} </div></td><td> {{ attr.metadata.name }} <div v-if="attr.metadata.data_type" class="text-caption"> Type: {{ attr.metadata.data_type }} </div></td><td><v-chip-group v-if="attr.valid_values.length > 0"><v-chip v-for="value in attr.valid_values" :key="value.id" size="small" variant="outlined" > {{ value.value }} </v-chip></v-chip-group><div v-else-if="attr.uom_codes.length > 0"><div v-for="uom in attr.uom_codes" :key="uom.id" class="text-caption"> {{ uom.description }} ({{ uom.code }}) </div></div><div v-else class="text-caption"> No constraints specified </div></td></tr></tbody></v-table></DetailCard></v-col></v-row></template><div v-else-if="loading" class="text-center my-8"><v-progress-circular indeterminate color="primary" size="64"></v-progress-circular><h3 class="mt-4">Loading part details...</h3></div><v-alert v-else-if="error" type="error" :text="error" variant="tonal" class="my-4"></v-alert><div v-else class="text-center my-8"><v-icon icon="mdi-wrench-off" size="64" color="grey"></v-icon><h3 class="mt-4">Part not found</h3></div></div></template><script setup lang="ts">import{ref,computed,onMounted,watch}from 'vue';import DetailCard from '@/components/common/DetailCard.vue';import InfoList from '@/components/common/InfoList.vue';import{usePCdbStore}from '@/stores/autocare/pcdb.store.ts';import{usePAdbStore}from '@/stores/autocare/padb.store.ts';import{PartDetail,PartAttributesResponse}from '@/types/autocare';const props=defineProps({partId:{type:[Number,String],required:true,},});const pcdbStore=usePCdbStore();const padbStore=usePAdbStore();const loading=ref(false);const error=ref('');const part=computed(()=>pcdbStore.currentPart);const partAttributes=computed(()=>padbStore.partAttributes);const partInfo=computed(()=>{if(!part.value)return[];return[{key:'part_terminology_id',label:'Part ID',value:part.value.part_terminology_id},{key:'part_terminology_name',label:'Name',value:part.value.part_terminology_name},];});const loadPart=async()=>{try{loading.value=true;error.value='';await pcdbStore.fetchPartDetails(Number(props.partId));await padbStore.fetchPartAttributes(Number(props.partId));}catch(err){console.error('Error loading part details:',err);error.value='Failed to load part details';}finally{loading.value=false;}};onMounted(()=>{loadPart();});watch(()=>props.partId,()=>{loadPart();});</script><style scoped>.part-details{width:100%}</style>