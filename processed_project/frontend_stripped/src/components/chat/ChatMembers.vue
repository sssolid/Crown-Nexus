<!-- frontend/src/components/chat/ChatMembers.vue --><template><div class="chat-members"><div class="panel-header"><h3>Members ({{ members.length }})</h3><v-btn icon variant="text" @click="$emit('close')"><v-icon>mdi-close</v-icon></v-btn></div><div class="search-container"><v-text-field v-model="searchQuery" placeholder="Search members" prepend-inner-icon="mdi-magnify" variant="outlined" density="compact" hide-details class="search-field" ></v-text-field></div><div class="member-actions"><v-btn v-if="canManageMembers" block color="primary" prepend-icon="mdi-account-plus" @click="$emit('add-member')" class="mb-4" > Add Member </v-btn></div><div class="members-list"><v-list><v-list-subheader v-if="onlineMembers.length > 0"> Online — {{ onlineMembers.length }} </v-list-subheader><v-list-item v-for="member in onlineMembers" :key="member.user_id" :title="member.user_name" :subtitle="getMemberRoleDisplay(member.role)" ><template v-slot:prepend><v-avatar color="primary" size="36"><span>{{ getMemberInitials(member.user_name) }}</span></v-avatar><v-icon color="success" size="12" class="status-icon">mdi-circle</v-icon></template><template v-slot:append><member-actions-menu v-if="canManageUser(member)" :member="member" :is-current-user="isCurrentUser(member)" @update-role="updateMemberRole" @remove-member="removeMember" /></template></v-list-item><!-- Offline members --><v-list-subheader v-if="offlineMembers.length > 0"> Offline — {{ offlineMembers.length }} </v-list-subheader><v-list-item v-for="member in offlineMembers" :key="member.user_id" :title="member.user_name" :subtitle="getMemberRoleDisplay(member.role)" ><template v-slot:prepend><v-avatar color="grey-lighten-2" size="36"><span>{{ getMemberInitials(member.user_name) }}</span></v-avatar></template><template v-slot:append><member-actions-menu v-if="canManageUser(member)" :member="member" :is-current-user="isCurrentUser(member)" @update-role="updateMemberRole" @remove-member="removeMember" /></template></v-list-item></v-list></div></div></template><script setup lang="ts">import{ref,computed}from 'vue';import{ChatMember,ChatRoom,ChatMemberRole}from '@/types/chat';const MemberActionsMenu=defineComponent({name:'MemberActionsMenu',props:{member:{type:Object as PropType<ChatMember>,required:true},isCurrentUser:{type:Boolean,default:false}},emits:['update-role','remove-member'],setup(props,{emit}){const showMenu=ref(false);return{showMenu,updateRole(role:string){emit('update-role',props.member.user_id,role);},removeMember(){emit('remove-member',props.member);}};},template:` <v-menu v-model=__STRING_0__ location=__STRING_1__><template v-slot:activator=__STRING_2__><v-btn icon size=__STRING_3__ variant=__STRING_4__ v-bind=__STRING_5__><v-icon>mdi-dots-vertical</v-icon></v-btn></template><v-list density=__STRING_6__><v-list-item v-if=__STRING_7__ prepend-icon=__STRING_8__ title=__STRING_9__ @click=__STRING_10__ v-show=__STRING_11__ ></v-list-item><v-list-item v-if=__STRING_12__ prepend-icon=__STRING_13__ title=__STRING_14__ @click=__STRING_15__ v-show=__STRING_16__ ></v-list-item><v-list-item v-if=__STRING_17__ prepend-icon=__STRING_18__ title=__STRING_19__ @click=__STRING_20__ class=__STRING_21__ v-show=__STRING_22__ ></v-list-item><v-list-item v-if=__STRING_23__ prepend-icon=__STRING_24__ title=__STRING_25__ @click=__STRING_26__ class=__STRING_27__ v-show=__STRING_28__ ></v-list-item></v-list></v-menu> `});const props=defineProps<{members:ChatMember[];room:ChatRoom;currentUserId:string;}>();const emit=defineEmits<{(e:'close'):void;(e:'add-member'):void;(e:'remove-member',member:ChatMember):void;(e:'update-role',userId:string,role:string):void;}>();const searchQuery=ref('');const filteredMembers=computed(()=>{if(!searchQuery.value.trim()){return props.members;}const query=searchQuery.value.toLowerCase();return props.members.filter(member=>member.user_name.toLowerCase().includes(query));});const onlineMembers=computed(()=>{return filteredMembers.value.filter(member=>member.is_online);});const offlineMembers=computed(()=>{return filteredMembers.value.filter(member=>!member.is_online);});const currentUserRole=computed(()=>{const currentUser=props.members.find(member=>member.user_id===props.currentUserId);return currentUser?currentUser.role:null;});const canManageMembers=computed(()=>{return currentUserRole.value===ChatMemberRole.ADMIN||currentUserRole.value===ChatMemberRole.OWNER;});function getMemberInitials(name:string):string{if(!name)return '';return name .split(' ').map(n=>n[0]).join('').slice(0,2).toUpperCase();}function getMemberRoleDisplay(role:string):string{switch(role){case ChatMemberRole.OWNER:return 'Owner';case ChatMemberRole.ADMIN:return 'Admin';case ChatMemberRole.MEMBER:return 'Member';default:return role;}}function isCurrentUser(member:ChatMember):boolean{return member.user_id===props.currentUserId;}function canManageUser(member:ChatMember):boolean{if(member.role===ChatMemberRole.OWNER){return false;}if(member.role===ChatMemberRole.ADMIN&&currentUserRole.value===ChatMemberRole.ADMIN){return false;}if(isCurrentUser(member)){return true;}return canManageMembers.value;}function updateMemberRole(userId:string,role:string){emit('update-role',userId,role);}function removeMember(member:ChatMember){emit('remove-member',member);}</script><style scoped>.chat-members{height:100%;display:flex;flex-direction:column}.panel-header{display:flex;align-items:center;justify-content:space-between;padding:16px;border-bottom:1px solid var(--v-neutral-200)}.panel-header h3{margin:0}.search-container{padding:16px 16px 8px}.search-field{margin-bottom:8px}.member-actions{padding:0 16px}.members-list{flex-grow:1;overflow-y:auto}.status-icon{position:absolute;bottom:12px;left:32px;border:2px solid var(--v-surface-base);border-radius:50%}</style>