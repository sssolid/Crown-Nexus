<!-- frontend/src/views/Settings.vue --><template><div><v-container fluid><v-row class="mb-6"><v-col cols="12"><h1 class="text-h3 font-weight-bold">System Settings</h1><p class="text-subtitle-1">Configure application settings and preferences</p></v-col></v-row><v-row><v-col cols="12" md="3"><v-card class="mb-6 md-mb-0"><v-list nav><v-list-item v-for="(item, index) in settingsMenu" :key="index" :value="item.value" @click="activeSection=item.value" :class="{'bg-primary-lighten-5': activeSection===item.value}" ><template v-slot:prepend><v-icon :icon="item.icon"></v-icon></template><v-list-item-title>{{ item.title }}</v-list-item-title></v-list-item></v-list></v-card></v-col><!-- Settings Content --><v-col cols="12" md="9"><!-- General Settings --><v-card v-if="activeSection === 'general'" class="mb-6"><v-card-title>General Settings</v-card-title><v-divider></v-divider><v-card-text><v-form ref="generalForm" v-model="isGeneralFormValid"><v-row><!-- Company Name --><v-col cols="12" sm="6"><v-text-field v-model="generalSettings.company_name" label="Company Name" variant="outlined" :rules="[rules.required]" hint="This will appear in the system header and reports" persistent-hint ></v-text-field></v-col><!-- Default Currency --><v-col cols="12" sm="6"><v-select v-model="generalSettings.currency" label="Default Currency" variant="outlined" :items="[ { title: 'US Dollar (USD)', value: 'USD' }, { title: 'Euro (EUR)', value: 'EUR' }, { title: 'British Pound (GBP)', value: 'GBP' }, { title: 'Canadian Dollar (CAD)', value: 'CAD' }, { title: 'Australian Dollar (AUD)', value: 'AUD' }, ]" item-title="title" item-value="value" hint="Used for pricing and reports" persistent-hint ></v-select></v-col><!-- Default Date Format --><v-col cols="12" sm="6"><v-select v-model="generalSettings.date_format" label="Date Format" variant="outlined" :items="[ { title: 'MM/DD/YYYY', value: 'MM/DD/YYYY' }, { title: 'DD/MM/YYYY', value: 'DD/MM/YYYY' }, { title: 'YYYY-MM-DD', value: 'YYYY-MM-DD' }, ]" item-title="title" item-value="value" ></v-select></v-col><!-- Default Time Zone --><v-col cols="12" sm="6"><v-select v-model="generalSettings.timezone" label="Default Time Zone" variant="outlined" :items="timezoneOptions" ></v-select></v-col><!-- Default Language --><v-col cols="12" sm="6"><v-select v-model="generalSettings.language" label="Default Language" variant="outlined" :items="[ { title: 'English', value: 'en' }, { title: 'Spanish', value: 'es' }, { title: 'French', value: 'fr' }, ]" item-title="title" item-value="value" ></v-select></v-col><!-- Items Per Page --><v-col cols="12" sm="6"><v-select v-model="generalSettings.items_per_page" label="Default Items Per Page" variant="outlined" :items="[10, 20, 50, 100]" ></v-select></v-col></v-row></v-form></v-card-text><v-divider></v-divider><v-card-actions class="pa-4"><v-spacer></v-spacer><v-btn color="primary" @click="saveGeneralSettings" :loading="savingGeneral" :disabled="!isGeneralFormValid" > Save Settings </v-btn></v-card-actions></v-card><!-- Theme Settings --><v-card v-if="activeSection === 'appearance'" class="mb-6"><v-card-title>Appearance & Theme</v-card-title><v-divider></v-divider><v-card-text><v-row><!-- Theme Mode --><v-col cols="12"><p class="text-subtitle-1 mb-2">Theme Mode</p><v-btn-toggle v-model="themeSettings.mode" mandatory class="mb-4" ><v-btn value="light"><v-icon start>mdi-white-balance-sunny</v-icon> Light </v-btn><v-btn value="dark"><v-icon start>mdi-moon-waning-crescent</v-icon> Dark </v-btn><v-btn value="system"><v-icon start>mdi-theme-light-dark</v-icon> System </v-btn></v-btn-toggle></v-col><!-- Primary Color --><v-col cols="12" sm="6"><p class="text-subtitle-1 mb-2">Primary Color</p><div class="d-flex align-center mb-4"><v-color-picker v-model="themeSettings.primary_color" hide-inputs hide-canvas show-swatches swatches-max-height="120px" ></v-color-picker></div></v-col><!-- Secondary Color --><v-col cols="12" sm="6"><p class="text-subtitle-1 mb-2">Secondary Color</p><div class="d-flex align-center mb-4"><v-color-picker v-model="themeSettings.secondary_color" hide-inputs hide-canvas show-swatches swatches-max-height="120px" ></v-color-picker></div></v-col><!-- Theme Preview --><v-col cols="12"><p class="text-subtitle-1 mb-2">Theme Preview</p><v-sheet rounded elevation="2" :class="themeSettings.mode === 'dark' ? 'bg-dark' : 'bg-white'" class="pa-4" ><div class="d-flex mb-4"><v-btn :color="themeSettings.primary_color" class="mr-2" > Primary </v-btn><v-btn :color="themeSettings.secondary_color" variant="tonal" class="mr-2" > Secondary </v-btn><v-btn variant="outlined" :color="themeSettings.primary_color" > Outlined </v-btn></div><div class="d-flex mb-4"><v-chip :color="themeSettings.primary_color" class="mr-2" > Primary </v-chip><v-chip :color="themeSettings.secondary_color" variant="tonal" class="mr-2" > Secondary </v-chip><v-chip variant="outlined" :color="themeSettings.primary_color" > Outlined </v-chip></div><v-text-field label="Text Field" variant="outlined" density="compact" :color="themeSettings.primary_color" hide-details class="mb-4" ></v-text-field><v-card :color="themeSettings.primary_color" class="mb-4" ><v-card-text :class="{'text-white': themeSettings.mode === 'dark'}"> This is a card with primary color </v-card-text></v-card></v-sheet></v-col><!-- Custom Logo --><v-col cols="12" class="mt-4"><p class="text-subtitle-1 mb-2">Custom Logo</p><v-file-input v-model="logoFile" accept="image/*" label="Upload Logo" variant="outlined" prepend-icon="mdi-image" hint="Recommended size: 200x50 pixels" persistent-hint ></v-file-input></v-col></v-row></v-card-text><v-divider></v-divider><v-card-actions class="pa-4"><v-spacer></v-spacer><v-btn color="primary" @click="saveThemeSettings" :loading="savingTheme" > Save Theme </v-btn></v-card-actions></v-card><!-- User & Permissions Settings --><v-card v-if="activeSection === 'users'" class="mb-6"><v-card-title>User & Permissions</v-card-title><v-divider></v-divider><v-card-text><v-form ref="userSettingsForm" v-model="isUserSettingsFormValid"><v-row><!-- Password Policy --><v-col cols="12"><p class="text-subtitle-1 mb-2">Password Policy</p><v-switch v-model="userSettings.require_strong_password" label="Require Strong Passwords" color="primary" hint="Passwords must have at least 8 characters including uppercase, lowercase, and numbers" persistent-hint class="mb-2" ></v-switch><v-slider v-model="userSettings.password_expiry_days" label="Password Expiry (Days)" hint="0 = Never expires" persistent-hint min="0" max="365" step="30" thumb-label :disabled="!userSettings.require_strong_password" ></v-slider></v-col><!-- Authentication --><v-col cols="12"><p class="text-subtitle-1 mb-2">Authentication</p><v-switch v-model="userSettings.enable_2fa" label="Enable Two-Factor Authentication" color="primary" hint="Require two-factor authentication for all users" persistent-hint class="mb-2" ></v-switch><v-slider v-model="userSettings.session_timeout" label="Session Timeout (Minutes)" hint="How long before inactive sessions expire" persistent-hint min="5" max="1440" step="5" thumb-label ></v-slider></v-col><!-- Registration --><v-col cols="12"><p class="text-subtitle-1 mb-2">User Registration</p><v-radio-group v-model="userSettings.registration_mode" inline ><v-radio label="Closed (Admin Only)" value="closed" ></v-radio><v-radio label="Approval Required" value="approval" ></v-radio><v-radio label="Open Registration" value="open" ></v-radio></v-radio-group><v-select v-model="userSettings.default_role" label="Default Role for New Users" variant="outlined" :items="roleOptions" item-title="title" item-value="value" hint="The role automatically assigned to new users" persistent-hint class="mt-2" :disabled="userSettings.registration_mode === 'closed'" ></v-select></v-col></v-row></v-form></v-card-text><v-divider></v-divider><v-card-actions class="pa-4"><v-spacer></v-spacer><v-btn color="primary" @click="saveUserSettings" :loading="savingUserSettings" :disabled="!isUserSettingsFormValid" > Save Settings </v-btn></v-card-actions></v-card><!-- Email Settings --><v-card v-if="activeSection === 'email'" class="mb-6"><v-card-title>Email Configuration</v-card-title><v-divider></v-divider><v-card-text><v-form ref="emailForm" v-model="isEmailFormValid"><v-row><!-- SMTP Settings --><v-col cols="12"><p class="text-subtitle-1 mb-2">SMTP Settings</p><v-text-field v-model="emailSettings.smtp_host" label="SMTP Host" variant="outlined" :rules="[rules.required]" class="mb-2" ></v-text-field><v-text-field v-model="emailSettings.smtp_port" label="SMTP Port" variant="outlined" type="number" :rules="[rules.required]" class="mb-2" ></v-text-field><v-text-field v-model="emailSettings.smtp_username" label="SMTP Username" variant="outlined" :rules="[rules.required]" class="mb-2" ></v-text-field><v-text-field v-model="emailSettings.smtp_password" label="SMTP Password" variant="outlined" type="password" :rules="[rules.required]" class="mb-2" ></v-text-field><v-switch v-model="emailSettings.smtp_encryption" label="Use SSL/TLS" color="primary" hint="Enable encryption for SMTP connection" persistent-hint class="mb-2" ></v-switch></v-col><!-- Email Templates --><v-col cols="12"><p class="text-subtitle-1 mb-2">Email Configuration</p><v-text-field v-model="emailSettings.from_email" label="From Email Address" variant="outlined" :rules="[rules.required, rules.email]" class="mb-2" ></v-text-field><v-text-field v-model="emailSettings.from_name" label="From Name" variant="outlined" :rules="[rules.required]" class="mb-2" ></v-text-field><v-select v-model="emailSettings.email_template" label="Email Template" variant="outlined" :items="[ { title: 'Default', value: 'default' }, { title: 'Minimalist', value: 'minimalist' }, { title: 'Branded', value: 'branded' }, ]" item-title="title" item-value="value" class="mb-2" ></v-select></v-col><!-- Test Email --><v-col cols="12"><p class="text-subtitle-1 mb-2">Test Configuration</p><v-text-field v-model="testEmailAddress" label="Test Email Address" variant="outlined" :rules="[rules.required, rules.email]" class="mb-2" ></v-text-field><v-btn color="primary" variant="tonal" @click="sendTestEmail" :loading="sendingTestEmail" :disabled="!testEmailAddress || !isEmailFormValid" > Send Test Email </v-btn></v-col></v-row></v-form></v-card-text><v-divider></v-divider><v-card-actions class="pa-4"><v-spacer></v-spacer><v-btn color="primary" @click="saveEmailSettings" :loading="savingEmail" :disabled="!isEmailFormValid" > Save Settings </v-btn></v-card-actions></v-card><!-- Integration Settings --><v-card v-if="activeSection === 'integrations'" class="mb-6"><v-card-title>External Integrations</v-card-title><v-divider></v-divider><v-card-text><v-tabs v-model="activeIntegrationTab"><v-tab value="api">API Configuration</v-tab><v-tab value="webhooks">Webhooks</v-tab><v-tab value="crm">CRM Integration</v-tab></v-tabs><v-window v-model="activeIntegrationTab" class="mt-4"><!-- API Configuration --><v-window-item value="api"><v-row><v-col cols="12"><v-switch v-model="integrationSettings.api_enabled" label="Enable API Access" color="primary" hint="Allow external applications to access the system via API" persistent-hint class="mb-4" ></v-switch><v-text-field v-model="integrationSettings.api_url" label="API Base URL" variant="outlined" hint="Base URL for API endpoints" persistent-hint :disabled="!integrationSettings.api_enabled" class="mb-4" ></v-text-field><v-slider v-model="integrationSettings.api_rate_limit" label="Rate Limit (Requests per Minute)" hint="Maximum number of API requests allowed per minute" persistent-hint min="10" max="1000" step="10" thumb-label :disabled="!integrationSettings.api_enabled" class="mb-4" ></v-slider><v-text-field v-model="integrationSettings.api_key" label="Master API Key" variant="outlined" readonly append-inner-icon="mdi-content-copy" @click:append-inner="copyApiKey" class="mb-4" :disabled="!integrationSettings.api_enabled" ></v-text-field><v-btn color="warning" variant="tonal" @click="regenerateApiKey" :disabled="!integrationSettings.api_enabled" class="mb-4" > Regenerate API Key </v-btn><v-alert type="info" variant="tonal" class="mt-4" > For more detailed API key management, please visit the <a href="#" @click.prevent="goToApiKeyManager">API Key Manager</a>. </v-alert></v-col></v-row></v-window-item><!-- Webhooks Configuration --><v-window-item value="webhooks"><v-row><v-col cols="12"><v-switch v-model="integrationSettings.webhooks_enabled" label="Enable Webhooks" color="primary" hint="Send event notifications to external URLs" persistent-hint class="mb-4" ></v-switch><v-expansion-panels v-if="integrationSettings.webhooks_enabled"><v-expansion-panel v-for="(webhook, index) in webhooks" :key="index" ><v-expansion-panel-title> {{ webhook.name || `Webhook #${index + 1}` }} <template v-slot:actions><v-switch v-model="webhook.active" color="primary" @click.stop hide-details density="compact" ></v-switch></template></v-expansion-panel-title><v-expansion-panel-text><v-text-field v-model="webhook.name" label="Webhook Name" variant="outlined" class="mb-2" ></v-text-field><v-text-field v-model="webhook.url" label="Endpoint URL" variant="outlined" :rules="[rules.required, rules.url]" class="mb-2" ></v-text-field><v-text-field v-model="webhook.secret" label="Secret Key" variant="outlined" class="mb-2" ></v-text-field><v-select v-model="webhook.events" label="Events" variant="outlined" :items="webhookEvents" multiple chips class="mb-2" ></v-select><div class="d-flex justify-end"><v-btn color="error" variant="text" @click="removeWebhook(index)" > Delete Webhook </v-btn><v-btn color="primary" variant="tonal" @click="testWebhook(webhook)" class="ml-2" > Test Webhook </v-btn></div></v-expansion-panel-text></v-expansion-panel></v-expansion-panels><v-btn color="primary" variant="tonal" prepend-icon="mdi-plus" @click="addWebhook" class="mt-4" :disabled="!integrationSettings.webhooks_enabled" > Add Webhook </v-btn></v-col></v-row></v-window-item><!-- CRM Integration --><v-window-item value="crm"><v-row><v-col cols="12"><v-select v-model="integrationSettings.crm_provider" label="CRM Provider" variant="outlined" :items="[ { title: 'None', value: 'none' }, { title: 'Salesforce', value: 'salesforce' }, { title: 'HubSpot', value: 'hubspot' }, { title: 'Zoho CRM', value: 'zoho' }, { title: 'Microsoft Dynamics', value: 'dynamics' }, ]" item-title="title" item-value="value" class="mb-4" ></v-select><div v-if="integrationSettings.crm_provider !== 'none'"><v-text-field v-model="integrationSettings.crm_api_key" label="API Key / Access Token" variant="outlined" :rules="[rules.required]" class="mb-2" ></v-text-field><v-text-field v-model="integrationSettings.crm_instance_url" label="Instance URL" variant="outlined" :rules="[rules.required]" class="mb-2" ></v-text-field><v-switch v-model="integrationSettings.crm_sync_customers" label="Sync Customers" color="primary" hint="Automatically sync customer data with CRM" persistent-hint class="mb-2" ></v-switch><v-switch v-model="integrationSettings.crm_sync_products" label="Sync Products" color="primary" hint="Automatically sync product data with CRM" persistent-hint class="mb-2" ></v-switch><v-btn color="primary" variant="tonal" @click="testCrmConnection" :loading="testingCrm" > Test Connection </v-btn></div></v-col></v-row></v-window-item></v-window></v-card-text><v-divider></v-divider><v-card-actions class="pa-4"><v-spacer></v-spacer><v-btn color="primary" @click="saveIntegrationSettings" :loading="savingIntegration" > Save Settings </v-btn></v-card-actions></v-card><!-- System Settings --><v-card v-if="activeSection === 'system'" class="mb-6"><v-card-title>System Settings</v-card-title><v-divider></v-divider><v-card-text><v-row><!-- System Info --><v-col cols="12"><v-card variant="outlined" class="mb-4"><v-card-text><div class="d-flex justify-space-between align-center mb-2"><div class="text-subtitle-1 font-weight-bold">System Version</div><div>{{ systemInfo.version }}</div></div><div class="d-flex justify-space-between align-center mb-2"><div class="text-subtitle-1 font-weight-bold">Last Updated</div><div>{{ formatDate(systemInfo.last_updated) }}</div></div><div class="d-flex justify-space-between align-center mb-2"><div class="text-subtitle-1 font-weight-bold">Database Version</div><div>{{ systemInfo.db_version }}</div></div><div class="d-flex justify-space-between align-center"><div class="text-subtitle-1 font-weight-bold">License Status</div><v-chip :color="systemInfo.license_valid ? 'success' : 'error'" size="small" variant="tonal" > {{ systemInfo.license_valid ? 'Valid' : 'Invalid' }} </v-chip></div></v-card-text></v-card></v-col><!-- Cache Management --><v-col cols="12"><p class="text-subtitle-1 mb-2">Cache Management</p><v-btn color="primary" variant="tonal" @click="clearSystemCache" :loading="clearingCache" class="mr-2" > Clear System Cache </v-btn><v-btn color="primary" variant="tonal" @click="rebuildSearch" :loading="rebuildingSearch" > Rebuild Search Index </v-btn></v-col><!-- Maintenance Mode --><v-col cols="12"><p class="text-subtitle-1 mb-2">Maintenance Mode</p><v-switch v-model="systemSettings.maintenance_mode" label="Enable Maintenance Mode" color="warning" hint="Put the system in maintenance mode. Only administrators will be able to access the system." persistent-hint class="mb-2" ></v-switch><v-textarea v-model="systemSettings.maintenance_message" label="Maintenance Message" variant="outlined" rows="3" auto-grow :disabled="!systemSettings.maintenance_mode" ></v-textarea></v-col><!-- Error Logging --><v-col cols="12"><p class="text-subtitle-1 mb-2">Error Logging</p><v-select v-model="systemSettings.log_level" label="Log Level" variant="outlined" :items="[ { title: 'Debug - Detailed Information', value: 'debug' }, { title: 'Info - Normal Operation', value: 'info' }, { title: 'Warning - Minor Issues', value: 'warning' }, { title: 'Error - Significant Problems', value: 'error' }, { title: 'Critical - Major Failures', value: 'critical' }, ]" item-title="title" item-value="value" class="mb-2" ></v-select><v-btn color="primary" variant="tonal" @click="downloadLogs" class="mr-2" > Download Logs </v-btn></v-col><!-- Backups --><v-col cols="12"><p class="text-subtitle-1 mb-2">Database Backups</p><v-switch v-model="systemSettings.auto_backup" label="Enable Automatic Backups" color="primary" hint="Create automatic backups of the database" persistent-hint class="mb-2" ></v-switch><v-select v-model="systemSettings.backup_frequency" label="Backup Frequency" variant="outlined" :items="[ { title: 'Daily', value: 'daily' }, { title: 'Weekly', value: 'weekly' }, { title: 'Monthly', value: 'monthly' }, ]" item-title="title" item-value="value" class="mb-2" :disabled="!systemSettings.auto_backup" ></v-select><v-text-field v-model="systemSettings.backup_retention" label="Backup Retention (Days)" variant="outlined" type="number" hint="How long to keep backups before auto-deletion" persistent-hint class="mb-2" :disabled="!systemSettings.auto_backup" ></v-text-field><v-btn color="primary" variant="tonal" @click="createBackup" :loading="creatingBackup" > Create Manual Backup </v-btn></v-col></v-row></v-card-text><v-divider></v-divider><v-card-actions class="pa-4"><v-spacer></v-spacer><v-btn color="primary" @click="saveSystemSettings" :loading="savingSystem" > Save Settings </v-btn></v-card-actions></v-card></v-col></v-row></v-container></div></template><script lang="ts">import{defineComponent,ref,computed,onMounted}from 'vue';import{useRouter}from 'vue-router';import{useAuthStore}from '@/stores/auth';import{formatDate}from '@/utils/formatters';import{notificationService}from '@/utils/notification';import{UserRole}from '@/types/user';interface Webhook{id?:string;name:string;url:string;secret:string;events:string[];active:boolean;}export default defineComponent({name:'Settings',setup(){const router=useRouter();const authStore=useAuthStore();const activeSection=ref('general');const activeIntegrationTab=ref('api');const generalForm=ref<any>(null);const emailForm=ref<any>(null);const userSettingsForm=ref<any>(null);const isGeneralFormValid=ref(true);const isEmailFormValid=ref(true);const isUserSettingsFormValid=ref(true);const savingGeneral=ref(false);const savingTheme=ref(false);const savingUserSettings=ref(false);const savingEmail=ref(false);const savingIntegration=ref(false);const savingSystem=ref(false);const sendingTestEmail=ref(false);const testingCrm=ref(false);const clearingCache=ref(false);const rebuildingSearch=ref(false);const creatingBackup=ref(false);const generalSettings=ref({company_name:'Crown Nexus',currency:'USD',date_format:'MM/DD/YYYY',timezone:'America/New_York',language:'en',items_per_page:20});const themeSettings=ref({mode:'light' as 'light'|'dark'|'system',primary_color:'#1976D2',secondary_color:'#424242'});const logoFile=ref<File|null>(null);const userSettings=ref({require_strong_password:true,password_expiry_days:90,enable_2fa:false,session_timeout:30,registration_mode:'closed' as 'closed'|'approval'|'open',default_role:UserRole.CLIENT});const emailSettings=ref({smtp_host:'smtp.example.com',smtp_port:587,smtp_username:'username',smtp_password:'password',smtp_encryption:true,from_email:'noreply@crownnexus.com',from_name:'Crown Nexus',email_template:'default'});const testEmailAddress=ref('');const integrationSettings=ref({api_enabled:true,api_url:'https: api_rate_limit: 100, api_key: 'sk_live_example123456789abcdef', webhooks_enabled: false, crm_provider: 'none' as 'none' | 'salesforce' | 'hubspot' | 'zoho' | 'dynamics', crm_api_key: '', crm_instance_url: '', crm_sync_customers: false, crm_sync_products: false }); const webhooks = ref<Webhook[]>([]); const webhookEvents = [ 'user.created', 'user.updated', 'product.created', 'product.updated', 'product.deleted', 'fitment.created', 'fitment.updated', 'fitment.deleted', 'order.created', 'order.updated', 'order.completed' ]; const systemSettings = ref({ maintenance_mode: false, maintenance_message: 'The system is currently undergoing scheduled maintenance. Please check back later.', log_level: 'info' as 'debug' | 'info' | 'warning' | 'error' | 'critical', auto_backup: true, backup_frequency: 'daily' as 'daily' | 'weekly' | 'monthly', backup_retention: 30 }); const systemInfo = ref({ version: '1.5.2', last_updated: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000), db_version: '1.5.0', license_valid: true, license_expires: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000) }); const settingsMenu = [ { title: 'General', value: 'general', icon: 'mdi-cog' }, { title: 'Appearance&Theme', value: 'appearance', icon: 'mdi-palette' }, { title: 'User&Permissions', value: 'users', icon: 'mdi-account-cog' }, { title: 'Email Configuration', value: 'email', icon: 'mdi-email' }, { title: 'External Integrations', value: 'integrations', icon: 'mdi-api' }, { title: 'System', value: 'system', icon: 'mdi-server' } ]; const roleOptions = [ { title: 'Administrator', value: UserRole.ADMIN }, { title: 'Manager', value: UserRole.MANAGER }, { title: 'Client', value: UserRole.CLIENT }, { title: 'Distributor', value: UserRole.DISTRIBUTOR }, { title: 'Read Only', value: UserRole.READ_ONLY } ]; const timezoneOptions = [ 'America/New_York', 'America/Chicago', 'America/Denver', 'America/Los_Angeles', 'Europe/London', 'Europe/Paris', 'Asia/Tokyo', 'Asia/Singapore', 'Australia/Sydney', 'Pacific/Auckland' ]; const rules = { required: (v: string) => !!v || 'This field is required', email: (v: string) => /.+@.+\..+/.test(v) || 'E-mail must be valid', url: (v: string) => /^https?:\/\/.+\..+/.test(v) || 'Must be a valid URL' }; const saveGeneralSettings = async () => { if (!isGeneralFormValid.value) { notificationService.error('Please correct the errors in the form'); return; } savingGeneral.value = true; try { await new Promise(resolve => setTimeout(resolve, 1000)); notificationService.success('General settings saved successfully'); } catch (error) { console.error('Error saving general settings:', error); notificationService.error('Failed to save general settings'); } finally { savingGeneral.value = false; } }; const saveThemeSettings = async () => { savingTheme.value = true; try { await new Promise(resolve => setTimeout(resolve, 1000)); document.documentElement.setAttribute('data-theme', themeSettings.value.mode); notificationService.success('Theme settings saved successfully'); } catch (error) { console.error('Error saving theme settings:', error); notificationService.error('Failed to save theme settings'); } finally { savingTheme.value = false; } }; const saveUserSettings = async () => { if (!isUserSettingsFormValid.value) { notificationService.error('Please correct the errors in the form'); return; } savingUserSettings.value = true; try { await new Promise(resolve => setTimeout(resolve, 1000)); notificationService.success('User settings saved successfully'); } catch (error) { console.error('Error saving user settings:', error); notificationService.error('Failed to save user settings'); } finally { savingUserSettings.value = false; } }; const saveEmailSettings = async () => { if (!isEmailFormValid.value) { notificationService.error('Please correct the errors in the form'); return; } savingEmail.value = true; try { await new Promise(resolve => setTimeout(resolve, 1000)); notificationService.success('Email settings saved successfully'); } catch (error) { console.error('Error saving email settings:', error); notificationService.error('Failed to save email settings'); } finally { savingEmail.value = false; } }; const sendTestEmail = async () => { if (!testEmailAddress.value) { notificationService.error('Please enter a test email address'); return; } sendingTestEmail.value = true; try { await new Promise(resolve => setTimeout(resolve, 2000)); notificationService.success(`Test email sent to ${testEmailAddress.value}`); } catch (error) { console.error('Error sending test email:', error); notificationService.error('Failed to send test email'); } finally { sendingTestEmail.value = false; } }; const saveIntegrationSettings = async () => { savingIntegration.value = true; try { await new Promise(resolve => setTimeout(resolve, 1000)); notificationService.success('Integration settings saved successfully'); } catch (error) { console.error('Error saving integration settings:', error); notificationService.error('Failed to save integration settings'); } finally { savingIntegration.value = false; } }; const addWebhook = () => { webhooks.value.push({ name: `Webhook ${webhooks.value.length + 1}`, url: '', secret: '', events: [], active: true }); }; const removeWebhook = (index: number) => { webhooks.value.splice(index, 1); }; const testWebhook = async (webhook: Webhook) => { if (!webhook.url) { notificationService.error('Webhook URL is required'); return; } try { await new Promise(resolve => setTimeout(resolve, 1000)); notificationService.success('Webhook test request sent successfully'); } catch (error) { console.error('Error testing webhook:', error); notificationService.error('Failed to test webhook'); } }; const copyApiKey = () => { navigator.clipboard.writeText(integrationSettings.value.api_key); notificationService.success('API key copied to clipboard'); }; const regenerateApiKey = async () => { try { await new Promise(resolve => setTimeout(resolve, 1000)); const randomKey = 'sk_live_' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15); integrationSettings.value.api_key = randomKey; notificationService.success('API key regenerated successfully'); } catch (error) { console.error('Error regenerating API key:', error); notificationService.error('Failed to regenerate API key'); } }; const testCrmConnection = async () => { if (integrationSettings.value.crm_provider === 'none') { notificationService.error('Please select a CRM provider'); return; } testingCrm.value = true; try { await new Promise(resolve => setTimeout(resolve, 2000)); notificationService.success('CRM connection successful'); } catch (error) { console.error('Error testing CRM connection:', error); notificationService.error('Failed to connect to CRM'); } finally { testingCrm.value = false; } }; const goToApiKeyManager = () => { notificationService.info('API Key Manager functionality not yet implemented'); }; const saveSystemSettings = async () => { savingSystem.value = true; try { await new Promise(resolve => setTimeout(resolve, 1000)); notificationService.success('System settings saved successfully'); } catch (error) { console.error('Error saving system settings:', error); notificationService.error('Failed to save system settings'); } finally { savingSystem.value = false; } }; const clearSystemCache = async () => { clearingCache.value = true; try { await new Promise(resolve => setTimeout(resolve, 2000)); notificationService.success('System cache cleared successfully'); } catch (error) { console.error('Error clearing cache:', error); notificationService.error('Failed to clear system cache'); } finally { clearingCache.value = false; } }; const rebuildSearch = async () => { rebuildingSearch.value = true; try { await new Promise(resolve => setTimeout(resolve, 3000)); notificationService.success('Search index rebuilt successfully'); } catch (error) { console.error('Error rebuilding search index:', error); notificationService.error('Failed to rebuild search index'); } finally { rebuildingSearch.value = false; } }; const createBackup = async () => { creatingBackup.value = true; try { await new Promise(resolve => setTimeout(resolve, 3000)); notificationService.success('Database backup created successfully'); } catch (error) { console.error('Error creating backup:', error); notificationService.error('Failed to create database backup'); } finally { creatingBackup.value = false; } }; const downloadLogs = () => { notificationService.info('Logs download started'); }; onMounted(() => { if (!authStore.isAdmin) { notificationService.error('You do not have permission to access system settings'); router.push('/'); } webhooks.value.push({ id: '1', name: 'Product Updates', url: 'https:secret:'whsec_abcdefg123456',events:['product.created','product.updated','product.deleted'],active:true});});return{activeSection,activeIntegrationTab,generalForm,emailForm,userSettingsForm,isGeneralFormValid,isEmailFormValid,isUserSettingsFormValid,savingGeneral,savingTheme,savingUserSettings,savingEmail,savingIntegration,savingSystem,sendingTestEmail,testingCrm,clearingCache,rebuildingSearch,creatingBackup,generalSettings,themeSettings,logoFile,userSettings,emailSettings,testEmailAddress,integrationSettings,webhooks,webhookEvents,systemSettings,systemInfo,settingsMenu,roleOptions,timezoneOptions,rules,formatDate,saveGeneralSettings,saveThemeSettings,saveUserSettings,saveEmailSettings,sendTestEmail,saveIntegrationSettings,addWebhook,removeWebhook,testWebhook,copyApiKey,regenerateApiKey,testCrmConnection,goToApiKeyManager,saveSystemSettings,clearSystemCache,rebuildSearch,createBackup,downloadLogs};}});</script><style scoped>.cursor-pointer{cursor:pointer}</style>